<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Squidstat API User Manual: The Basics of Running Experiments</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="Admiral_Instruments_Logo.webp"/></td>
  <td id="projectalign">
   <div id="projectname">Squidstat API User Manual
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_intro_and_examples_5_basics.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">The Basics of Running Experiments </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="basics"></a></p>
<p >The basic building block of a custom experiment are the elements. An element is an elementary experiment such as Constant Voltage/Potential (CV) or Constant Current (CC). A custom experiment can have one or more elements. The elements inside could be run one or more times. A custom experiment can also contain another custom experiment as a sub-experiment. The sub-experiment can be run one or more times as well.</p>
<p >We will go through an example of building and running an experiment.</p>
<h2><a class="anchor" id="autotoc_md19"></a>
Creating A Custom Experiment</h2>
<p >First, we will have some environment setup by creating our application:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;AisDeviceTracker.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;AisCustomExperiment.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;experiments/builder_elements/AisConstantCurrentElement.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;experiments/builder_elements/AisConstantPotElement.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">char</span>** test = <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="keywordtype">int</span> args;</div>
<div class="line">QCoreApplication app(args, test);</div>
</div><!-- fragment --><p >To build a custom experiment, we need at least one element. In the example we will build below, we have two elements and a sub-experiment. The sub-experiment has the same two elements only with their parameters changed.</p>
<p >Let us go through it step by step:</p>
<p >We first create a constant voltage element and set its parameters as seen in the following code block. You can see a full list of the available elements in the classes section. For now, we are only setting the required parameters. You can get a complete list of settable parameters for any given element type by examining the corresponding element class.</p>
<div class="fragment"><div class="line"><span class="comment">// constructing a constant potential element with required arguments</span></div>
<div class="line"><a class="code hl_class" href="class_ais_constant_pot_element.html">AisConstantPotElement</a> cvElement(</div>
<div class="line">    5, <span class="comment">// voltage: 5v</span></div>
<div class="line">    1, <span class="comment">// sampling interval: 1s</span></div>
<div class="line">    10 <span class="comment">// duration: 10s</span></div>
<div class="line">);</div>
<div class="ttc" id="aclass_ais_constant_pot_element_html"><div class="ttname"><a href="class_ais_constant_pot_element.html">AisConstantPotElement</a></div><div class="ttdoc">an experiment that simulates a constant applied voltage.</div><div class="ttdef"><b>Definition:</b> AisConstantPotElement.h:15</div></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>for each element you use, you need to include its corresponding header file.</dd></dl>
<p>We create another element of a different type.</p>
<div class="fragment"><div class="line"><span class="comment">// constructing a constant current element with required arguments</span></div>
<div class="line"><a class="code hl_class" href="class_ais_constant_current_element.html">AisConstantCurrentElement</a> ccElement(</div>
<div class="line">    1, <span class="comment">// current: 1A</span></div>
<div class="line">    1, <span class="comment">// sampling interval: 1s</span></div>
<div class="line">    60 <span class="comment">// duration: 60s</span></div>
<div class="line">);</div>
<div class="ttc" id="aclass_ais_constant_current_element_html"><div class="ttname"><a href="class_ais_constant_current_element.html">AisConstantCurrentElement</a></div><div class="ttdoc">an experiment that simulates a constant current flow with more advance options for stopping the exper...</div><div class="ttdef"><b>Definition:</b> AisConstantCurrentElement.h:15</div></div>
</div><!-- fragment --><p >We create a custom experiment and add the previously created elements to it.</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> customExperiment = std::make_shared&lt;AisExperiment&gt;();  <span class="comment">// at this point, it is an empty custom experiment, so, we add the elements we created to it.</span></div>
<div class="line">customExperiment-&gt;appendElement(ccElement, 1); <span class="comment">// append the CC element to the end of the experiment and set it to run 1 time</span></div>
<div class="line">customExperiment-&gt;appendElement(cvElement, 1); <span class="comment">// append the CV element to the end of the experiment and set it to run 1 time</span></div>
</div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd>Elements are run in the order that they are added to the experiment</dd></dl>
<p>Next, we create a second experiment as a sub-experiment i.e. we are going to then add it to the main experiment.</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> subExperiment = std::make_shared&lt;AisExperiment&gt;(); <span class="comment">// this line creates a custom experiment, intended to be used as a sub-subExperiment</span></div>
<div class="line">subExperiment.appendElement(ccElement, 2); <span class="comment">// append the CC element to the sub-experiment and set it to run 2 times</span></div>
<div class="line">subExperiment.appendElement(cvElement, 3); <span class="comment">// append the CV element to the sub-experiment and set it to run 3 times</span></div>
<div class="line">customExperiment-&gt;appendSubExperiment(&amp;subExperiment, 2); <span class="comment">// append the sub-experiment to the main experiment and set the sub-experiment to run 2 times.</span></div>
</div><!-- fragment --><p >Again, the order adding/appending the elements and the sub-experiment here corresponds to the order at which they will run. The sub-experiment and the elements it contains will be run after the elements already added to the main experiment</p>
<p >We create an additional constant voltage element with a different voltage setpoint.</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="class_ais_constant_pot_element.html">AisConstantPotElement</a> cvElement_2(</div>
<div class="line">    4, <span class="comment">// voltage: 4v</span></div>
<div class="line">    1, <span class="comment">// sampling interval: 1s</span></div>
<div class="line">    10 <span class="comment">// duration: 10s</span></div>
<div class="line">);</div>
</div><!-- fragment --><p >This concludes creating the experiment. Next is how to control the workflow of the experiment.</p>
<h2><a class="anchor" id="autotoc_md20"></a>
Controlling The Experiment</h2>
<p >So far, we have only created the experiment. But we need to start it and control it. The next code section employs a callback mechanism specific to Qt, called signals and slots. Callbacks are used to take an action when a specified condition is met i.e. control the workflow. For simplicity, we provided some common slots related to our API with comments inside, on what you can do. You can read more about Qt signals and slots in the following link: <a href="https://doc.qt.io/qt-5/signalsandslots.html">https://doc.qt.io/qt-5/signalsandslots.html</a></p>
<p >Reading this document should still cover most of what is needed. Basically, a signal can be emitted when an event happens. If a slot is connected to that signal, whatever is inside that slot will be executed when the signal is emitted. You can think of a signal as a condition and a slot is what will be executed once a corresponding condition is met. The only difference is the order of execution. Normal execution have sequential order. However, a slot can be emitted at anytime. Whenever that happens, the slot will execute no matter where the connection has been made (as long as a connection has been made prior). That is how we can have extra control on how and when things are executed.</p>
<p >An experiment is run on a specific channel of a device. You may have more than one device connected. A single device has up to 4 channels. Any channel on a specific device can run a single experiment at a time. To start an experiment, we specify the device and the channel and, then start it. To stop or pause that experiment, we need to specify its corresponding device and channel. We need to keep track of the device and channel for each experiment we start so we can control it later.</p>
<p >We can control a device, including starting, pausing and stopping an experiment on a specific channel using an <a class="el" href="class_ais_instrument_handler.html">AisInstrumentHandler</a> A device/instrument handler can be created given a device name that we detect.</p>
<p >We have two parts below: one that creates logic using signals and slots. The second part assigns that logic to an instrument handler which will discuss in a bit. The first part below is creating some control-flow logic that we can assign to a handler. We can also create other logics in the same way that can be assigned to different handlers which can be used to control different devices. If we only have one device, all the logic will be handled with one handler. We can then have further control within, based on channels.</p>
<h3><a class="anchor" id="autotoc_md21"></a>
Creating Control Flow Logic Specific To A Handler</h3>
<p >The first part is a lambda function called "connectHandlerSignals" which takes a handler as an argument and connects some of the handler signals to slots. We have other signals related to a handler you can add, which you can find in the <a class="el" href="class_ais_instrument_handler.html">AisInstrumentHandler</a> This example logic has four conditions on which we can perform other tasks. That is, when we assign this logic to a specific handler, this logic will execute for that handler. The four signals and slots below in the first part are examples for you to follow in order to add other connections.</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> connectHandlerSignals = [=](<a class="code hl_class" href="class_ais_instrument_handler.html">AisInstrumentHandler</a>* handler) {</div>
<div class="line">    QObject::connect(handler, &amp;<a class="code hl_signal" href="class_ais_instrument_handler.html#a3de1ee62bac5796ef2d4e24dfb75eebf">AisInstrumentHandler::activeDCDataReady</a>, [=](uint8_t channel, <span class="keyword">const</span> <a class="code hl_struct" href="struct_ais_d_c_data.html">AisDCData</a>&amp; data) {</div>
<div class="line">        <span class="comment">// do something when DC data are received, such as writing to a CSV file output</span></div>
<div class="line">        <span class="comment">// THIS IS WHERE YOU RECEIVE DC DATA FROM THE DEVICE</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">//example: print the data to the standard output as follows:</span></div>
<div class="line">        qDebug() &lt;&lt; <span class="stringliteral">&quot;channel: &quot;</span> &lt;&lt; (int)channel &lt;&lt; <span class="stringliteral">&quot;current :&quot;</span> &lt;&lt; data.<a class="code hl_variable" href="struct_ais_d_c_data.html#a8dbf057e272af392efcfdc6343eb1db5">current</a> &lt;&lt; <span class="stringliteral">&quot;   voltage: &quot;</span> &lt;&lt; data.<a class="code hl_variable" href="struct_ais_d_c_data.html#ad49c1bb5b6e60fe631e174f64f40afbe">workingElectrodeVoltage</a> &lt;&lt; <span class="stringliteral">&quot;   counter electrode : &quot;</span> &lt;&lt; data.<a class="code hl_variable" href="struct_ais_d_c_data.html#a6c765ec62a21cddb6482eebf64e5c812">counterElectrodeVoltage</a> &lt;&lt; <span class="stringliteral">&quot;  timestamp : &quot;</span> &lt;&lt; data.<a class="code hl_variable" href="struct_ais_d_c_data.html#ae394dc60504aa5fdbc06604265d71881">timestamp</a>;</div>
<div class="line">    });</div>
<div class="line"> </div>
<div class="line">    QObject::connect(handler, &amp;<a class="code hl_signal" href="class_ais_instrument_handler.html#a2f319978ea32fc5cf0c5282857bfa405">AisInstrumentHandler::activeACDataReady</a>, [=](uint8_t channel, <span class="keyword">const</span> <a class="code hl_struct" href="struct_ais_a_c_data.html">AisACData</a>&amp;) {</div>
<div class="line">        <span class="comment">// do something when AC data are received</span></div>
<div class="line">        <span class="comment">// THIS IS WHERE YOU RECEIVE AC (EIS) DATA FROM THE DEVICE</span></div>
<div class="line">    });</div>
<div class="line"> </div>
<div class="line">    QObject::connect(handler, &amp;<a class="code hl_signal" href="class_ais_instrument_handler.html#a9d0df19029d26b1cce0d05650ecfa854">AisInstrumentHandler::experimentNewElementStarting</a>, [=](uint8_t channel, <span class="keyword">const</span> <a class="code hl_struct" href="struct_ais_experiment_node.html">AisExperimentNode</a>&amp;) {</div>
<div class="line">        <span class="comment">// do something when a new element is starting</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">// for example, print to the standard output: &quot;New element starting&quot;</span></div>
<div class="line">        qDebug() &lt;&lt; <span class="stringliteral">&quot;New element starting&quot;</span>;</div>
<div class="line">    });</div>
<div class="line"> </div>
<div class="line">    QObject::connect(handler, &amp;<a class="code hl_signal" href="class_ais_instrument_handler.html#a391573a96037abefe0004b4a19c05bd3">AisInstrumentHandler::experimentStopped</a>, [=](uint8_t channel) {</div>
<div class="line">        <span class="comment">// do something when the experiment has stopped or has been stopped. For example, you can invoke starting the next step in your workflow</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">// print to the standard output: &quot;Experiment stopped Signal &quot;</span></div>
<div class="line">        qDebug() &lt;&lt; <span class="stringliteral">&quot;Experiment Stopped Signal &quot;</span> &lt;&lt; channel;</div>
<div class="line">    });</div>
<div class="line">};</div>
<div class="ttc" id="aclass_ais_instrument_handler_html"><div class="ttname"><a href="class_ais_instrument_handler.html">AisInstrumentHandler</a></div><div class="ttdoc">this class provides control of the device including starting, pausing, resuming and stopping an exper...</div><div class="ttdef"><b>Definition:</b> AisInstrumentHandler.h:24</div></div>
<div class="ttc" id="aclass_ais_instrument_handler_html_a2f319978ea32fc5cf0c5282857bfa405"><div class="ttname"><a href="class_ais_instrument_handler.html#a2f319978ea32fc5cf0c5282857bfa405">AisInstrumentHandler::activeACDataReady</a></div><div class="ttdeci">void activeACDataReady(uint8_t channel, const AisACData &amp;ACData)</div><div class="ttdoc">a signal that is emitted whenever new AC data for an active experiment are ready.</div></div>
<div class="ttc" id="aclass_ais_instrument_handler_html_a391573a96037abefe0004b4a19c05bd3"><div class="ttname"><a href="class_ais_instrument_handler.html#a391573a96037abefe0004b4a19c05bd3">AisInstrumentHandler::experimentStopped</a></div><div class="ttdeci">void experimentStopped(uint8_t channel)</div><div class="ttdoc">a signal that is emitted whenever an experiment was stopped manually or has completed.</div></div>
<div class="ttc" id="aclass_ais_instrument_handler_html_a3de1ee62bac5796ef2d4e24dfb75eebf"><div class="ttname"><a href="class_ais_instrument_handler.html#a3de1ee62bac5796ef2d4e24dfb75eebf">AisInstrumentHandler::activeDCDataReady</a></div><div class="ttdeci">void activeDCDataReady(uint8_t channel, const AisDCData &amp;DCData)</div><div class="ttdoc">a signal that is emitted whenever new DC data for an active experiment are ready.</div></div>
<div class="ttc" id="aclass_ais_instrument_handler_html_a9d0df19029d26b1cce0d05650ecfa854"><div class="ttname"><a href="class_ais_instrument_handler.html#a9d0df19029d26b1cce0d05650ecfa854">AisInstrumentHandler::experimentNewElementStarting</a></div><div class="ttdeci">void experimentNewElementStarting(uint8_t channel, const AisExperimentNode &amp;stepInfo)</div><div class="ttdoc">a signal that is emitted whenever a new elemental experiment has started.</div></div>
<div class="ttc" id="astruct_ais_a_c_data_html"><div class="ttname"><a href="struct_ais_a_c_data.html">AisACData</a></div><div class="ttdoc">a structure containing AC data information.</div><div class="ttdef"><b>Definition:</b> AisDataPoints.h:38</div></div>
<div class="ttc" id="astruct_ais_d_c_data_html"><div class="ttname"><a href="struct_ais_d_c_data.html">AisDCData</a></div><div class="ttdoc">a structure containing DC data information.</div><div class="ttdef"><b>Definition:</b> AisDataPoints.h:7</div></div>
<div class="ttc" id="astruct_ais_d_c_data_html_a6c765ec62a21cddb6482eebf64e5c812"><div class="ttname"><a href="struct_ais_d_c_data.html#a6c765ec62a21cddb6482eebf64e5c812">AisDCData::counterElectrodeVoltage</a></div><div class="ttdeci">double counterElectrodeVoltage</div><div class="ttdoc">the measured counter electrode voltage in volts.</div><div class="ttdef"><b>Definition:</b> AisDataPoints.h:22</div></div>
<div class="ttc" id="astruct_ais_d_c_data_html_a8dbf057e272af392efcfdc6343eb1db5"><div class="ttname"><a href="struct_ais_d_c_data.html#a8dbf057e272af392efcfdc6343eb1db5">AisDCData::current</a></div><div class="ttdeci">double current</div><div class="ttdoc">the measured electric current value in Amps</div><div class="ttdef"><b>Definition:</b> AisDataPoints.h:27</div></div>
<div class="ttc" id="astruct_ais_d_c_data_html_ad49c1bb5b6e60fe631e174f64f40afbe"><div class="ttname"><a href="struct_ais_d_c_data.html#ad49c1bb5b6e60fe631e174f64f40afbe">AisDCData::workingElectrodeVoltage</a></div><div class="ttdeci">double workingElectrodeVoltage</div><div class="ttdoc">the measured working electrode voltage in volts.</div><div class="ttdef"><b>Definition:</b> AisDataPoints.h:17</div></div>
<div class="ttc" id="astruct_ais_d_c_data_html_ae394dc60504aa5fdbc06604265d71881"><div class="ttname"><a href="struct_ais_d_c_data.html#ae394dc60504aa5fdbc06604265d71881">AisDCData::timestamp</a></div><div class="ttdeci">double timestamp</div><div class="ttdoc">the time at which the DC data arrived.</div><div class="ttdef"><b>Definition:</b> AisDataPoints.h:12</div></div>
<div class="ttc" id="astruct_ais_experiment_node_html"><div class="ttname"><a href="struct_ais_experiment_node.html">AisExperimentNode</a></div><div class="ttdoc">a structure containing some information regarding the running element.</div><div class="ttdef"><b>Definition:</b> AisDataPoints.h:107</div></div>
</div><!-- fragment --><p >For a more complex logic for running a sequence of experiments, please refer to <a class="el" href="md_intro_and_examples_8_control_flow_demo.html#controlFlowDemo">this example</a></p>
<p >If you would like to output the incoming data to a file such as a CSV file, you may modify the last block to something as follows:</p>
<div class="fragment"><div class="line">QString filePath;</div>
<div class="line"><span class="keyword">auto</span> connectHandlerSignals = [=, &amp;filePath](<span class="keyword">const</span> <a class="code hl_class" href="class_ais_instrument_handler.html">AisInstrumentHandler</a>* handler) {</div>
<div class="line"> </div>
<div class="line">    QObject::connect(handler, &amp;<a class="code hl_signal" href="class_ais_instrument_handler.html#a9d0df19029d26b1cce0d05650ecfa854">AisInstrumentHandler::experimentNewElementStarting</a>, [=, &amp;filePath](uint8_t channel, <span class="keyword">const</span> <a class="code hl_struct" href="struct_ais_experiment_node.html">AisExperimentNode</a>&amp; node) {</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">auto</span> utcTime = handler-&gt;getExperimentUTCStartTime(0);</div>
<div class="line">        <span class="keyword">auto</span> name = <span class="stringliteral">&quot;/&quot;</span> + QString::number(node.<a class="code hl_variable" href="struct_ais_experiment_node.html#a7cee5797e9099af54630461cf1b4cbec">stepNumber</a>) + <span class="stringliteral">&quot; &quot;</span> + node.<a class="code hl_variable" href="struct_ais_experiment_node.html#a15a697a5ddf65fa131b316b470fe8075">stepName</a> + <span class="stringliteral">&quot; &quot;</span> + QString::number(utcTime) + <span class="stringliteral">&quot;.csv&quot;</span>;</div>
<div class="line">        filePath = (QString(QStandardPaths::writableLocation(QStandardPaths::DesktopLocation)) + name);</div>
<div class="line"> </div>
<div class="line">        QFile file(filePath);</div>
<div class="line">        <span class="keywordflow">if</span> (!file.open(QIODevice::WriteOnly | QIODevice::Text)) <span class="comment">// overwrite existing files with the same name</span></div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">        QTextStream out(&amp;file);</div>
<div class="line">        out &lt;&lt; <span class="stringliteral">&quot;Time Stamp,&quot;</span></div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;Counter Electrode Voltage,&quot;</span></div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;Working Electrode Voltage,&quot;</span></div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;Current&quot;</span></div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">        file.close();</div>
<div class="line"> </div>
<div class="line">        qDebug() &lt;&lt; <span class="stringliteral">&quot;New element beginning: &quot;</span> &lt;&lt; node.<a class="code hl_variable" href="struct_ais_experiment_node.html#a15a697a5ddf65fa131b316b470fe8075">stepName</a> &lt;&lt; <span class="stringliteral">&quot;step: &quot;</span> &lt;&lt; node.<a class="code hl_variable" href="struct_ais_experiment_node.html#a7cee5797e9099af54630461cf1b4cbec">stepNumber</a>;</div>
<div class="line">    });</div>
<div class="line"> </div>
<div class="line">    QObject::connect(handler, &amp;<a class="code hl_signal" href="class_ais_instrument_handler.html#a3de1ee62bac5796ef2d4e24dfb75eebf">AisInstrumentHandler::activeDCDataReady</a>, [=, &amp;filePath](uint8_t channel, <span class="keyword">const</span> <a class="code hl_struct" href="struct_ais_d_c_data.html">AisDCData</a>&amp; data) {</div>
<div class="line">        qDebug() &lt;&lt; <span class="stringliteral">&quot;current :&quot;</span> &lt;&lt; data.<a class="code hl_variable" href="struct_ais_d_c_data.html#a8dbf057e272af392efcfdc6343eb1db5">current</a> &lt;&lt; <span class="stringliteral">&quot;   voltage: &quot;</span> &lt;&lt; data.<a class="code hl_variable" href="struct_ais_d_c_data.html#ad49c1bb5b6e60fe631e174f64f40afbe">workingElectrodeVoltage</a> &lt;&lt; <span class="stringliteral">&quot;   counter electrode : &quot;</span> &lt;&lt; data.<a class="code hl_variable" href="struct_ais_d_c_data.html#a6c765ec62a21cddb6482eebf64e5c812">counterElectrodeVoltage</a> &lt;&lt; <span class="stringliteral">&quot;  timestamp : &quot;</span> &lt;&lt; data.<a class="code hl_variable" href="struct_ais_d_c_data.html#ae394dc60504aa5fdbc06604265d71881">timestamp</a>;</div>
<div class="line"> </div>
<div class="line">        QFile file(filePath);</div>
<div class="line">        <span class="keywordflow">if</span> (!file.open(QIODevice::Append | QIODevice::WriteOnly | QIODevice::Text))</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        QTextStream out(&amp;file);</div>
<div class="line">        out &lt;&lt; data.<a class="code hl_variable" href="struct_ais_d_c_data.html#ae394dc60504aa5fdbc06604265d71881">timestamp</a> &lt;&lt; <span class="stringliteral">&quot;,&quot;</span></div>
<div class="line">            &lt;&lt; data.<a class="code hl_variable" href="struct_ais_d_c_data.html#a6c765ec62a21cddb6482eebf64e5c812">counterElectrodeVoltage</a> &lt;&lt; <span class="stringliteral">&quot;,&quot;</span></div>
<div class="line">            &lt;&lt; data.<a class="code hl_variable" href="struct_ais_d_c_data.html#ad49c1bb5b6e60fe631e174f64f40afbe">workingElectrodeVoltage</a> &lt;&lt; <span class="stringliteral">&quot;,&quot;</span></div>
<div class="line">            &lt;&lt; data.<a class="code hl_variable" href="struct_ais_d_c_data.html#a8dbf057e272af392efcfdc6343eb1db5">current</a></div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">        file.close();</div>
<div class="line">    });</div>
<div class="line"> </div>
<div class="line">    QObject::connect(handler, &amp;<a class="code hl_signal" href="class_ais_instrument_handler.html#a2f319978ea32fc5cf0c5282857bfa405">AisInstrumentHandler::activeACDataReady</a>, [=](uint8_t channel, <span class="keyword">const</span> <a class="code hl_struct" href="struct_ais_a_c_data.html">AisACData</a>&amp; data) {</div>
<div class="line">        qDebug() &lt;&lt; data.<a class="code hl_variable" href="struct_ais_a_c_data.html#ac6b51ee0dfd56a5ad9f919a6c325aa4f">frequency</a> &lt;&lt; <span class="stringliteral">&quot;         &quot;</span> &lt;&lt; data.<a class="code hl_variable" href="struct_ais_a_c_data.html#aa7f020bc2d02d3bd63880f4290dc82b2">absoluteImpedance</a> &lt;&lt; <span class="stringliteral">&quot;        &quot;</span> &lt;&lt; data.<a class="code hl_variable" href="struct_ais_a_c_data.html#af1eb5d7ed33b0e383bb966548c82c640">phaseAngle</a>;</div>
<div class="line">    });</div>
<div class="line"> </div>
<div class="line">    QObject::connect(handler, &amp;<a class="code hl_signal" href="class_ais_instrument_handler.html#a391573a96037abefe0004b4a19c05bd3">AisInstrumentHandler::experimentStopped</a>, [=](uint8_t channel) {</div>
<div class="line">        qDebug() &lt;&lt; <span class="stringliteral">&quot;Experiment Completed Signal &quot;</span> &lt;&lt; channel;</div>
<div class="line">    });</div>
<div class="line">};</div>
<div class="ttc" id="astruct_ais_a_c_data_html_aa7f020bc2d02d3bd63880f4290dc82b2"><div class="ttname"><a href="struct_ais_a_c_data.html#aa7f020bc2d02d3bd63880f4290dc82b2">AisACData::absoluteImpedance</a></div><div class="ttdeci">double absoluteImpedance</div><div class="ttdoc">the magnitude of the complex impedance.</div><div class="ttdef"><b>Definition:</b> AisDataPoints.h:53</div></div>
<div class="ttc" id="astruct_ais_a_c_data_html_ac6b51ee0dfd56a5ad9f919a6c325aa4f"><div class="ttname"><a href="struct_ais_a_c_data.html#ac6b51ee0dfd56a5ad9f919a6c325aa4f">AisACData::frequency</a></div><div class="ttdeci">double frequency</div><div class="ttdoc">the applied frequency in Hz.</div><div class="ttdef"><b>Definition:</b> AisDataPoints.h:48</div></div>
<div class="ttc" id="astruct_ais_a_c_data_html_af1eb5d7ed33b0e383bb966548c82c640"><div class="ttname"><a href="struct_ais_a_c_data.html#af1eb5d7ed33b0e383bb966548c82c640">AisACData::phaseAngle</a></div><div class="ttdeci">double phaseAngle</div><div class="ttdoc">the phase angle between the real and the imaginary parts of the impedance.</div><div class="ttdef"><b>Definition:</b> AisDataPoints.h:68</div></div>
<div class="ttc" id="astruct_ais_experiment_node_html_a15a697a5ddf65fa131b316b470fe8075"><div class="ttname"><a href="struct_ais_experiment_node.html#a15a697a5ddf65fa131b316b470fe8075">AisExperimentNode::stepName</a></div><div class="ttdeci">QString stepName</div><div class="ttdoc">This is the name of the current element running.</div><div class="ttdef"><b>Definition:</b> AisDataPoints.h:112</div></div>
<div class="ttc" id="astruct_ais_experiment_node_html_a7cee5797e9099af54630461cf1b4cbec"><div class="ttname"><a href="struct_ais_experiment_node.html#a7cee5797e9099af54630461cf1b4cbec">AisExperimentNode::stepNumber</a></div><div class="ttdeci">int stepNumber</div><div class="ttdoc">this number is the order of the element within the custom experiment.</div><div class="ttdef"><b>Definition:</b> AisDataPoints.h:117</div></div>
</div><!-- fragment --><p >Here we output the DC data to a CSV file but, you may do that for AC data as well in the same manner.</p>
<p >You may also find it useful to refer to C++ lambdas documentation: <a href="https://docs.microsoft.com/en-us/cpp/cpp/lambda-expressions-in-cpp">https://docs.microsoft.com/en-us/cpp/cpp/lambda-expressions-in-cpp</a></p>
<h3><a class="anchor" id="autotoc_md22"></a>
Connecting Slots To Device-Tracker Signals</h3>
<p >There are two signals related to a device tracker: when a device is connected and second, when a device is disconnected.</p>
<h4><a class="anchor" id="autotoc_md23"></a>
When a Device is Connected</h4>
<p >This connects a slot to the device tracker's <a class="el" href="class_ais_device_tracker.html#af0985ed0e0e7ba1b5168767720a5f0ff" title="a signal to be emitted whenever a new connection has been successfully established with a device.">AisDeviceTracker::newDeviceConnected</a> signal that provides the device name. Because we have the device name, we can create a device handler and do whatever a handler can do. In this slot example, we are creating a handler, assigning the previously created logic to this handler and then starting an experiment.</p>
<div class="fragment"><div class="line">QObject::connect(tracker, &amp;<a class="code hl_signal" href="class_ais_device_tracker.html#af0985ed0e0e7ba1b5168767720a5f0ff">AisDeviceTracker::newDeviceConnected</a>, &amp;app, [=](<span class="keyword">const</span> QString&amp; deviceName) {</div>
<div class="line">    <span class="comment">// Do something when a new device is detected to be connected. The device name is given in the variable &#39;deviceName&#39;</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// The following lines start the experiment that we created</span></div>
<div class="line">    <span class="keyword">auto</span> handler = tracker-&gt;getInstrumentHandler(deviceName); <span class="comment">// create a device handler using the given device name</span></div>
<div class="line">    connectHandlerSignals(handler); <span class="comment">// connect the signals we created for the device. This is done once per device.</span></div>
<div class="line">    <span class="keyword">auto</span> error = handler-&gt;uploadExperimentToChannel(0, customExperiment); <span class="comment">// upload to a specific channel (first arg) an experiment (second arg) on the given</span></div>
<div class="line">    device controlled by the handler.</div>
<div class="line">    <span class="keywordflow">if</span> (error) {</div>
<div class="line">        qDebug() &lt;&lt; error.message();</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keyword">auto</span> error = handler-&gt;startUploadedExperiment(0); <span class="comment">// start the previously uploaded experiment on the given channel.</span></div>
<div class="line">    <span class="keywordflow">if</span> (error) {</div>
<div class="line">        qDebug() &lt;&lt; error.message();</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">});</div>
<div class="ttc" id="aclass_ais_device_tracker_html_af0985ed0e0e7ba1b5168767720a5f0ff"><div class="ttname"><a href="class_ais_device_tracker.html#af0985ed0e0e7ba1b5168767720a5f0ff">AisDeviceTracker::newDeviceConnected</a></div><div class="ttdeci">void newDeviceConnected(const QString &amp;deviceName)</div><div class="ttdoc">a signal to be emitted whenever a new connection has been successfully established with a device.</div></div>
</div><!-- fragment --><p >Please refer to <a class="el" href="class_ais_instrument_handler.html">AisInstrumentHandler</a> for possible errors that may occur when performing operations such as uploading and starting an experiment. For example, when uploading an experiment, <a class="el" href="class_ais_instrument_handler.html#a5096c381f44458a8875cad033072be57" title="upload an already created custom experiment to a specific channel on the device.">AisInstrumentHandler::uploadExperimentToChannel</a> may return an <a class="el" href="class_ais_error_code.html#aa1d7e88850560cfd6229469c60e3311aa2db4bc733c63671c5b85250a15d857e4">AisErrorCode::InvalidParameters</a> error if the parameters are out of range where you can display the message to check which parameter was not supported for your device.</p>
<dl class="section note"><dt>Note</dt><dd>Specific to the cycler model, before starting an experiment, you have the option of linking channels so that you can share the electric current over multiple channels using <a class="el" href="class_ais_instrument_handler.html#ac1a5a72c7ba4b72af7965e86d53cb427" title="connect several channels together in parallel mode.">AisInstrumentHandler::setLinkedChannels</a>. If using paralleled channels, <a class="el" href="class_ais_instrument_handler.html#ac1a5a72c7ba4b72af7965e86d53cb427" title="connect several channels together in parallel mode.">AisInstrumentHandler::setLinkedChannels</a> MUST be called before each experiment that uses paralleled channels. To link channels on the cycler, you can modify the last code by first linking the channels, and then uploading and starting the experiment on the master channel for the linked channels:</dd></dl>
<div class="fragment"><div class="line"><span class="keyword">auto</span> masterchannel = handler-&gt;setLinkedChannels({ 0, 1 }); <span class="comment">// this does two things, first links the given channels and second returns the masterchannel used to control the combined output.</span></div>
<div class="line">handler-&gt;uploadExperimentToChannel(masterchannel, customExperiment);</div>
<div class="line">handler-&gt;startUploadedExperiment(masterchannel);</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md24"></a>
When a Device is Disconnected</h4>
<p >The following code connects a slot to the device tracker's <a class="el" href="class_ais_device_tracker.html#a10daf47917dabe80b74b362e0a4416db" title="a signal to be emitted whenever a device has been disconnected.">AisDeviceTracker::deviceDisconnected</a> signal with the device name.</p>
<div class="fragment"><div class="line">QObject::connect(tracker, &amp;<a class="code hl_signal" href="class_ais_device_tracker.html#a10daf47917dabe80b74b362e0a4416db">AisDeviceTracker::deviceDisconnected</a>, &amp;app, [=](<span class="keyword">const</span> QString&amp; deviceName) {</div>
<div class="line">        <span class="comment">// do something when a device has been disconnected. The device name is given in the variable &#39;deviceName&#39;</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">// for example, print to the standard output that the device given is disconnected</span></div>
<div class="line">        qDebug() &lt;&lt; deviceName &lt;&lt; <span class="stringliteral">&quot;is disconnected &quot;</span>;</div>
<div class="line">    });</div>
<div class="ttc" id="aclass_ais_device_tracker_html_a10daf47917dabe80b74b362e0a4416db"><div class="ttname"><a href="class_ais_device_tracker.html#a10daf47917dabe80b74b362e0a4416db">AisDeviceTracker::deviceDisconnected</a></div><div class="ttdeci">void deviceDisconnected(const QString &amp;deviceName)</div><div class="ttdoc">a signal to be emitted whenever a device has been disconnected.</div></div>
</div><!-- fragment --><p >We still have not started the experiment, we've only created an experiment and setup callback functions via signals. When we connect a device using the tracker as shown below, the <a class="el" href="class_ais_device_tracker.html#af0985ed0e0e7ba1b5168767720a5f0ff" title="a signal to be emitted whenever a new connection has been successfully established with a device.">AisDeviceTracker::newDeviceConnected</a> signal will be emitted with the device name. As a result, the slot we connected earlier to the signal <a class="el" href="class_ais_device_tracker.html#af0985ed0e0e7ba1b5168767720a5f0ff" title="a signal to be emitted whenever a new connection has been successfully established with a device.">AisDeviceTracker::newDeviceConnected</a> will execute (connecting the other signals and running the experiment). </p><dl class="section note"><dt>Note</dt><dd>in the example we showed, the function connectHandlerSignals is intentionally called inside the <a class="el" href="class_ais_device_tracker.html#af0985ed0e0e7ba1b5168767720a5f0ff" title="a signal to be emitted whenever a new connection has been successfully established with a device.">AisDeviceTracker::newDeviceConnected</a> slot because connectHandlerSignals needs a valid handler. When <a class="el" href="class_ais_device_tracker.html#af0985ed0e0e7ba1b5168767720a5f0ff" title="a signal to be emitted whenever a new connection has been successfully established with a device.">AisDeviceTracker::newDeviceConnected</a> is emitted, we know we can get a device handler for the newly connected device and then control the device with the handler.</dd></dl>
<p>Now to connect the device, the easiest way to connect all plugged-in devices is to call <a class="el" href="class_ais_device_tracker.html#abb8abce4de564252066d06925e25d13d" title="connect all devices physically plugged to the computer.">AisDeviceTracker::connectAllPluggedInDevices</a>:</p>
<div class="fragment"><div class="line">tracker-&gt;connectAllPluggedInDevices();</div>
</div><!-- fragment --><p >To connect specific devices, you may alternatively call <a class="el" href="class_ais_device_tracker.html#a3369b0043dd80bd1ab4e23dabe236097" title="establish a connection with a device connected on a USB port.">AisDeviceTracker::connectToDeviceOnComPort</a> with a specific COM port.</p>
<div class="fragment"><div class="line">tracker-&gt;connectToDeviceOnComPort(<span class="stringliteral">&quot;COM3&quot;</span>); <span class="comment">// change the port number to yours. For example, in windows, you can find it from the device manager</span></div>
</div><!-- fragment --><p >Finally, we can start the application by calling:</p>
<div class="fragment"><div class="line">app.exec();</div>
</div><!-- fragment --><p >In the <a class="el" href="md_intro_and_examples_8_control_flow_demo.html#controlFlowDemo">next section</a>, we introduce a more advanced control flow. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
