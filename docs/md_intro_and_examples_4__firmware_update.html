<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Squidstat API User Manual: Updating Firmware</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="Admiral_Instruments_Logo.webp"/></td>
  <td id="projectalign">
   <div id="projectname">Squidstat API User Manual
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_intro_and_examples_4__firmware_update.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Updating Firmware </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="firmwareupdate"></a></p>
<h3><a class="anchor" id="autotoc_md12"></a>
Introduction</h3>
<p >When connecting a new Squidstat or switching to a different version of the API, users may be required to update the firmware of the device. The following example will walk through the FirmwareUpdateDemo to demonstrate how to update the firmware for all connected Squidstats or select Squidstats.</p>
<p >&gt;Note: If you are a Linux user and are having issues updating the firmware with your Squidstat, please refer to the announcement posted on the discussions page of our <a href="https://github.com/Admiral-Instruments/AdmiralSquidstatAPI/discussions">GitHub</a> for troubleshooting guidelines.</p>
<h4><a class="anchor" id="autotoc_md13"></a>
Import all required classes from SquidstatLibrary and Qt Library</h4>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;AisDeviceTracker.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;QCoreApplication&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;qdebug.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;qfileinfo.h&gt;</span></div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md14"></a>
Connect to the firmware progress notification</h4>
<p >As the device updates the firmware, it will periodically send a notification that will include a percentage representing its progress. Here we will directly relay that message to the command line via the standard QT message handler <code>qInfo</code>. Because it is connected to a signal, it will be handled asynchronously. </p><div class="fragment"><div class="line">QObject::connect(tracker, &amp;AisDeviceTracker::firmwareUpdateNotification, &amp;a, [=](<span class="keyword">const</span> QString&amp; message) {</div>
<div class="line">           qInfo() &lt;&lt; message;</div>
<div class="line">});</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md15"></a>
Request to update the firmware in all connected devices</h4>
<p >At the point where we call <code>tracker-&gt;updateFirmwareOnAllAvailableDevices()</code>, the API will look for all devices connected and send them the signal to update their firmware. <code>numberOfDevices</code> will hold the number of devices that responded that their firmware was out of date. Once we call <code>exec</code> on our QT application, it will begin updating the firmware and reporting the update progress via the <code>firmwareUpdateNotification</code> signal that we connected to earlier. </p><div class="fragment"><div class="line"><span class="keyword">auto</span> numberOfDevices = tracker-&gt;updateFirmwareOnAllAvailableDevices();</div>
<div class="line"><span class="keywordflow">if</span> (numberOfDevices == 0) {</div>
<div class="line">      qInfo() &lt;&lt; <span class="stringliteral">&quot;No devices need to be updated at this time. If this is incorrect, ensure all devices are connected and powered on.&quot;</span>;</div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">     qInfo() &lt;&lt; <span class="stringliteral">&quot;Firmware update starting on &quot;</span> &lt;&lt; numberOfDevices &lt;&lt; <span class="stringliteral">&quot;devices.&quot;</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md16"></a>
Request to update the firmware to a specific device by comport</h4>
<p >If the user wishes to specify a comport to update a specific Squidstat, that can be put in as an argument in this script. Here we check that the value follows the proper format via regex, and if it does, we begin the update via <code>tracker-&gt;updateFirmwareOnComPort(comPort)</code>. We will also report any error that may have occurred during this process.</p>
<div class="fragment"><div class="line">QRegExp rx(<span class="stringliteral">&quot;^[Cc][Oo][Mm][0-9]+$&quot;</span>);</div>
<div class="line"><span class="keywordflow">if</span> (rx.exactMatch(comPort) == <span class="keyword">false</span>) {</div>
<div class="line">   qInfo() &lt;&lt; <span class="stringliteral">&quot; Arguments are not valid. Example: &quot;</span> &lt;&lt; QFileInfo(QCoreApplication::applicationFilePath()).fileName() &lt;&lt; <span class="stringliteral">&quot; COM3&quot;</span>;</div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">   <span class="keyword">auto</span> error = tracker-&gt;updateFirmwareOnComPort(comPort);</div>
<div class="line">   <span class="keywordflow">if</span> (error) {</div>
<div class="line">      qInfo() &lt;&lt; error.message();                </div>
<div class="line">   }</div>
<div class="line">}</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md17"></a>
Start the QT Application</h4>
<p >Once we call <code>exec</code> on our QT application, it will begin reporting the update progress via the <code>firmwareUpdateNotification</code> signal that we connected to earlier. </p><div class="fragment"><div class="line">a.exec();</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md18"></a>
Full Example</h4>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;AisDeviceTracker.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;QCoreApplication&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;qdebug.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;qfileinfo.h&gt;</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div>
<div class="line">{</div>
<div class="line">    QCoreApplication a(argc, argv);</div>
<div class="line">    <span class="keyword">auto</span> tracker = AisDeviceTracker::Instance();</div>
<div class="line">    QObject::connect(tracker, &amp;AisDeviceTracker::firmwareUpdateNotification, &amp;a, [=](<span class="keyword">const</span> QString&amp; message) {</div>
<div class="line">           qInfo() &lt;&lt; message;</div>
<div class="line">        });</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (argc == 1) { </div>
<div class="line">        <span class="keyword">auto</span> numberOfDevices = tracker-&gt;updateFirmwareOnAllAvailableDevices();</div>
<div class="line">        <span class="keywordflow">if</span> (numberOfDevices == 0) {</div>
<div class="line">            qInfo() &lt;&lt; <span class="stringliteral">&quot;No devices need to be updated at this time. If this is incorrect, ensure all devices are connected and powered on.&quot;</span>;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            qInfo() &lt;&lt; <span class="stringliteral">&quot;Firmware update starting on &quot;</span> &lt;&lt; numberOfDevices &lt;&lt; <span class="stringliteral">&quot;devices.&quot;</span>;</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (argc == 2) {</div>
<div class="line">            <span class="keyword">auto</span> comPort = argv[1];</div>
<div class="line">            </div>
<div class="line">            QRegExp rx(<span class="stringliteral">&quot;^[Cc][Oo][Mm][0-9]+$&quot;</span>);</div>
<div class="line">            <span class="keywordflow">if</span> (rx.exactMatch(comPort) == <span class="keyword">false</span>) {</div>
<div class="line">                qInfo() &lt;&lt; <span class="stringliteral">&quot; Arguments are not valid. Example: &quot;</span> &lt;&lt; QFileInfo(QCoreApplication::applicationFilePath()).fileName() &lt;&lt; <span class="stringliteral">&quot; COM3&quot;</span>;</div>
<div class="line">          </div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                <span class="keyword">auto</span> error = tracker-&gt;updateFirmwareOnComPort(comPort);</div>
<div class="line">                <span class="keywordflow">if</span> (error) {</div>
<div class="line">                    qInfo() &lt;&lt; error.message();</div>
<div class="line">                    </div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    a.exec();</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
