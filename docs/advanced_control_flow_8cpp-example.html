<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!-- BEGIN opengraph metadata -->
<meta property="og:title" content="Doxygen Awesome" />
<meta property="og:image" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta property="og:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<meta property="og:url" content="https://jothepro.github.io/doxygen-awesome-css/" />
<!-- END opengraph metadata -->
<!-- BEGIN twitter metadata -->
<meta name="twitter:image:src" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta name="twitter:title" content="Doxygen Awesome" />
<meta name="twitter:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<!-- END twitter metadata -->
<title>Squidstat API User Manual: advancedControlFlow.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/svg+xml" href="logo.drawio.svg"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Admiral_Instruments_Logo.webp"/></td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('advanced_control_flow_8cpp-example.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">advancedControlFlow.cpp</div></div>
</div><!--header-->
<div class="contents">
<p>This example shows how we can setup an advanced control flow for a sequence of experiments. For simplicity we will be using an incremented integer as an external condition to control the workflow. This logic can be replaced with any sort of logic pertaining to external instruments, sensors, or any other conditions.</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;AisExperiment.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;AisDeviceTracker.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;AisInstrumentHandler.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;experiments/builder_elements/AisConstantCurrentElement.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;experiments/builder_elements/AisConstantPotElement.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;QCoreApplication&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;QTimer&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;qdebug.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Environment Setup</span></div>
<div class="line">    <span class="keywordtype">char</span>** test = <span class="keyword">nullptr</span>;</div>
<div class="line">    <span class="keywordtype">int</span> args;</div>
<div class="line">    QCoreApplication a(args, test); <span class="comment">// this creates a non-GUI Qt application</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// constructing a constant potential element with required arguments</span></div>
<div class="line">    <a id="_a0" name="_a0"></a><a class="code hl_class" href="class_ais_constant_pot_element.html">AisConstantPotElement</a> cvElement(</div>
<div class="line">        5, <span class="comment">// voltage: 1v</span></div>
<div class="line">        1, <span class="comment">// sampling interval: 1s</span></div>
<div class="line">        10 <span class="comment">// duration: 10s</span></div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// constructing a constant current element with required arguments</span></div>
<div class="line">    <a id="_a1" name="_a1"></a><a class="code hl_class" href="class_ais_constant_current_element.html">AisConstantCurrentElement</a> ccElement(</div>
<div class="line">        0.002,  <span class="comment">// current: 2mA</span></div>
<div class="line">        1,      <span class="comment">// sampling interval: 1s</span></div>
<div class="line">        10      <span class="comment">// duration: 10s</span></div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> experimentA = std::make_shared&lt;AisExperiment&gt;(); <span class="comment">// create a custom experiment</span></div>
<div class="line">    experimentA-&gt;appendElement(cvElement, 1); <span class="comment">// append to experimentA, the created CV element and set it to run 1 time</span></div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> experimentB = std::make_shared&lt;AisExperiment&gt;(); <span class="comment">// create a second experiment</span></div>
<div class="line">    experimentB-&gt;appendElement(ccElement, 1); <span class="comment">// append to experimentB, the created CC element and set it to run 1 time</span></div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> experimentC = std::make_shared&lt;AisExperiment&gt;(); <span class="comment">// create a third experiment</span></div>
<div class="line">    experimentC-&gt;appendElement(cvElement, 2); <span class="comment">// append to experimentC, the created CV element and set it to run 2 times</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">    * Now we have the experiments set up. Next we will create the logic for the sequence of experiments.</span></div>
<div class="line"><span class="comment">    * We will be using timers as external conditions to control the workflow. You may substitute that with your own conditions.</span></div>
<div class="line"><span class="comment">    *</span></div>
<div class="line"><span class="comment">    * The following lambda function creates a logic and assigns it to the given handler.</span></div>
<div class="line"><span class="comment">    * We will call this function after a newDeviceConnected signal has been emitted and a handler has been created.</span></div>
<div class="line"><span class="comment">    * The logic controls the workflow as follows:</span></div>
<div class="line"><span class="comment">    * # Start the first timer</span></div>
<div class="line"><span class="comment">    * # once the timer times out, start Experiment A</span></div>
<div class="line"><span class="comment">    * # once Experiment A completes, start the second timer</span></div>
<div class="line"><span class="comment">    * # once the second timer times out, start Experiment B</span></div>
<div class="line"><span class="comment">    * # start a third timer to stop Experiment B early</span></div>
<div class="line"><span class="comment">    * # once the third timer out, stop Experiment B</span></div>
<div class="line"><span class="comment">    * # start a fourth timer</span></div>
<div class="line"><span class="comment">    * # once the fourth timer times out, start Experiment C</span></div>
<div class="line"><span class="comment">    * # once Experiment C completes, start Experiment B</span></div>
<div class="line"><span class="comment">    */</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Lambda function</span></div>
<div class="line">    <span class="keyword">auto</span> createLogic = [&amp;](<span class="keyword">const</span> <a id="_a2" name="_a2"></a><a class="code hl_class" href="class_ais_instrument_handler.html">AisInstrumentHandler</a>* handler) {</div>
<div class="line">        QTimer* timer1 = <span class="keyword">new</span> QTimer(); <span class="comment">// the first timer is used in lieu of the first external condition</span></div>
<div class="line">        timer1-&gt;setSingleShot(<span class="keyword">true</span>);</div>
<div class="line">        timer1-&gt;start(1000);</div>
<div class="line"> </div>
<div class="line">        QObject::connect(timer1, &amp;QTimer::timeout, [=]() {</div>
<div class="line">            qDebug() &lt;&lt; <span class="stringliteral">&quot;Initial condition met. Starting Experiment A &quot;</span>;</div>
<div class="line">            handler-&gt;uploadExperimentToChannel(0, experimentA);</div>
<div class="line">            handler-&gt;startUploadedExperiment(0);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// once the first experiment is completed (Experiment A), start the next experiment (Experiment B).</span></div>
<div class="line">            <span class="comment">// this signal will be emitted for any experiment not just A so, we will track of the sequence with experimentStep</span></div>
<div class="line">            <span class="comment">// once an experiment has completed or has been stopped, continue to the next experimentStep</span></div>
<div class="line">            QObject::connect(handler, &amp;<a id="a3" name="a3"></a><a class="code hl_signal" href="class_ais_instrument_handler.html#ad252ccab4eaccb8bf1247ffb249c8ff8">AisInstrumentHandler::experimentStopped</a>, [&amp;](uint8_t channel) {</div>
<div class="line">                <span class="keyword">static</span> <span class="keywordtype">int</span> experimentStep = 0;</div>
<div class="line">                qDebug() &lt;&lt; <span class="stringliteral">&quot;Experiment Step &quot;</span> &lt;&lt; experimentStep &lt;&lt; <span class="stringliteral">&quot; Completed&quot;</span>;</div>
<div class="line"> </div>
<div class="line">                experimentStep++; <span class="comment">//increment the experiment step</span></div>
<div class="line">                <span class="keywordflow">if</span> (experimentStep == 1) {</div>
<div class="line">                    <span class="comment">// Wait for external start condition</span></div>
<div class="line">                    QTimer* timer = <span class="keyword">new</span> QTimer(); <span class="comment">// the timer is used in lieu of an external condition</span></div>
<div class="line">                    timer-&gt;setSingleShot(<span class="keyword">true</span>);</div>
<div class="line">                    timer-&gt;start(10000); <span class="comment">// when this timer times out, the next experiment (Experiment B) will start</span></div>
<div class="line"> </div>
<div class="line">                    <span class="comment">// Create an external condition that will stop the upcoming experiment early</span></div>
<div class="line">                    QTimer* StopEarlyTimer = <span class="keyword">new</span> QTimer();</div>
<div class="line">                    StopEarlyTimer-&gt;setSingleShot(<span class="keyword">true</span>);</div>
<div class="line">                    QObject::connect(StopEarlyTimer, &amp;QTimer::timeout, [&amp;]() {</div>
<div class="line">                        qDebug() &lt;&lt; <span class="stringliteral">&quot;External early stop condition met&quot;</span>;</div>
<div class="line">                        handler-&gt;stopExperiment(0); <span class="comment">// Once the external condition is met, experiment B will stop, and the experimentCompleted signal will be emitted</span></div>
<div class="line">                    });</div>
<div class="line"> </div>
<div class="line">                    QObject::connect(timer, &amp;QTimer::timeout, [&amp;, StopEarlyTimer]() {</div>
<div class="line">                        qDebug() &lt;&lt; <span class="stringliteral">&quot;External condition met, starting experiment B&quot;</span>;</div>
<div class="line">                        handler-&gt;uploadExperimentToChannel(0, experimentB); <span class="comment">// start Experiment B</span></div>
<div class="line">                        handler-&gt;startUploadedExperiment(0);</div>
<div class="line">                        StopEarlyTimer-&gt;start(2000);</div>
<div class="line">                    });</div>
<div class="line">                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (experimentStep == 2) {</div>
<div class="line">                    QTimer* timer = <span class="keyword">new</span> QTimer(); <span class="comment">// the timer is used in lieu of an external condition</span></div>
<div class="line">                    timer-&gt;setSingleShot(<span class="keyword">true</span>);</div>
<div class="line">                    timer-&gt;start(10000); <span class="comment">// when this timer times out, the next experiment (Experiment C) will start</span></div>
<div class="line"> </div>
<div class="line">                    QObject::connect(timer, &amp;QTimer::timeout, [&amp;]() {</div>
<div class="line">                        qDebug() &lt;&lt; <span class="stringliteral">&quot;External condition met, starting Experiment C &quot;</span>;</div>
<div class="line">                        handler-&gt;uploadExperimentToChannel(0, experimentC); <span class="comment">// start Experiment C</span></div>
<div class="line">                        handler-&gt;startUploadedExperiment(0);</div>
<div class="line">                    });</div>
<div class="line">                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (experimentStep == 3) {</div>
<div class="line">                    QTimer* timer = <span class="keyword">new</span> QTimer(); <span class="comment">// the timer is used in lieu of an external condition</span></div>
<div class="line">                    timer-&gt;setSingleShot(<span class="keyword">true</span>);</div>
<div class="line">                    timer-&gt;start(10000); <span class="comment">// when this timer times out, the next experiment (Experiment B) will start</span></div>
<div class="line"> </div>
<div class="line">                    QObject::connect(timer, &amp;QTimer::timeout, [&amp;]() {</div>
<div class="line">                        qDebug() &lt;&lt; <span class="stringliteral">&quot;External condition met, starting Experiment B &quot;</span>;</div>
<div class="line">                        handler-&gt;uploadExperimentToChannel(0, experimentB); <span class="comment">// start Experiment B</span></div>
<div class="line">                        handler-&gt;startUploadedExperiment(0);</div>
<div class="line">                    });</div>
<div class="line">                }</div>
<div class="line">            });</div>
<div class="line">        });</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// this is a signal-slot connection where the slot assigns the logic to the device handler when newDeviceConnected signal is emitted.</span></div>
<div class="line">    <span class="keyword">auto</span> tracker = <a id="a4" name="a4"></a><a class="code hl_function" href="class_ais_device_tracker.html#adc58454bc5bfc76b3c8fc3fad40d2f1c">AisDeviceTracker::Instance</a>(); <span class="comment">// create a tracker that tracks connected devices</span></div>
<div class="line">    QObject::connect(tracker, &amp;<a id="a5" name="a5"></a><a class="code hl_signal" href="class_ais_device_tracker.html#af0985ed0e0e7ba1b5168767720a5f0ff">AisDeviceTracker::newDeviceConnected</a>, &amp;a, [&amp;](<span class="keyword">const</span> QString&amp; deviceName) {</div>
<div class="line">        <span class="keyword">auto</span>&amp; handler = tracker-&gt;getInstrumentHandler(deviceName);</div>
<div class="line">        createLogic(&amp;handler); <span class="comment">// controlling experiments is to be done only after a device handler has been assigned. That is why it is placed inside this slot.</span></div>
<div class="line">    });</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// here we have a signal and slot for when a device has been disconnected</span></div>
<div class="line">    QObject::connect(tracker, &amp;<a id="a6" name="a6"></a><a class="code hl_signal" href="class_ais_device_tracker.html#a10daf47917dabe80b74b362e0a4416db">AisDeviceTracker::deviceDisconnected</a>, &amp;a, [=](<span class="keyword">const</span> QString&amp; deviceName) {</div>
<div class="line">        qDebug() &lt;&lt; deviceName &lt;&lt; <span class="stringliteral">&quot;is disconnected &quot;</span>;</div>
<div class="line">    });</div>
<div class="line"> </div>
<div class="line">    <a id="_a7" name="_a7"></a><a class="code hl_class" href="class_ais_error_code.html">AisErrorCode</a> error = tracker-&gt;connectToDeviceOnComPort(<span class="stringliteral">&quot;COM18&quot;</span>); <span class="comment">// change the port number to your device. For example, in windows, you can find it from the device manager</span></div>
<div class="line">    <span class="keywordflow">if</span> (error != error.Success) {</div>
<div class="line">        qDebug() &lt;&lt; error.message();</div>
<div class="line">    }</div>
<div class="line">    a.exec();</div>
<div class="line">}</div>
<div class="ttc" id="aclass_ais_constant_current_element_html"><div class="ttname"><a href="class_ais_constant_current_element.html">AisConstantCurrentElement</a></div><div class="ttdoc">an experiment that simulates a constant current flow with more advance options for stopping the exper...</div><div class="ttdef"><b>Definition</b> AisConstantCurrentElement.h:18</div></div>
<div class="ttc" id="aclass_ais_constant_pot_element_html"><div class="ttname"><a href="class_ais_constant_pot_element.html">AisConstantPotElement</a></div><div class="ttdoc">an experiment that simulates a constant applied voltage.</div><div class="ttdef"><b>Definition</b> AisConstantPotElement.h:18</div></div>
<div class="ttc" id="aclass_ais_device_tracker_html_a10daf47917dabe80b74b362e0a4416db"><div class="ttname"><a href="class_ais_device_tracker.html#a10daf47917dabe80b74b362e0a4416db">AisDeviceTracker::deviceDisconnected</a></div><div class="ttdeci">void deviceDisconnected(const QString &amp;deviceName)</div><div class="ttdoc">a signal to be emitted whenever a device has been disconnected.</div></div>
<div class="ttc" id="aclass_ais_device_tracker_html_adc58454bc5bfc76b3c8fc3fad40d2f1c"><div class="ttname"><a href="class_ais_device_tracker.html#adc58454bc5bfc76b3c8fc3fad40d2f1c">AisDeviceTracker::Instance</a></div><div class="ttdeci">static AisDeviceTracker * Instance()</div><div class="ttdoc">get the instance of the device tracker.</div></div>
<div class="ttc" id="aclass_ais_device_tracker_html_af0985ed0e0e7ba1b5168767720a5f0ff"><div class="ttname"><a href="class_ais_device_tracker.html#af0985ed0e0e7ba1b5168767720a5f0ff">AisDeviceTracker::newDeviceConnected</a></div><div class="ttdeci">void newDeviceConnected(const QString &amp;deviceName)</div><div class="ttdoc">a signal to be emitted whenever a new connection has been successfully established with a device.</div></div>
<div class="ttc" id="aclass_ais_error_code_html"><div class="ttname"><a href="class_ais_error_code.html">AisErrorCode</a></div><div class="ttdoc">This class contains the possible error codes returned to the user when working with the API....</div><div class="ttdef"><b>Definition</b> AisErrorCode.h:18</div></div>
<div class="ttc" id="aclass_ais_instrument_handler_html"><div class="ttname"><a href="class_ais_instrument_handler.html">AisInstrumentHandler</a></div><div class="ttdoc">this class provides control of the device including starting, pausing, resuming and stopping an exper...</div><div class="ttdef"><b>Definition</b> AisInstrumentHandler.h:27</div></div>
<div class="ttc" id="aclass_ais_instrument_handler_html_ad252ccab4eaccb8bf1247ffb249c8ff8"><div class="ttname"><a href="class_ais_instrument_handler.html#ad252ccab4eaccb8bf1247ffb249c8ff8">AisInstrumentHandler::experimentStopped</a></div><div class="ttdeci">void experimentStopped(uint8_t channel, const QString &amp;reason)</div><div class="ttdoc">a signal that is emitted whenever an experiment was stopped manually or has completed.</div></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
